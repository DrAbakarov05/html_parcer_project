# -*- coding: utf-8 -*-
# Auto-converted from Jupyter Notebook to Python (.py)
# Source notebook: Html_parser.ipynb
# Converted: 2025-08-12T13:57:09
# Cell markers `# %%` preserve original cell boundaries.

# %%
"""
–ú–æ–¥—É–ª—å –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ HTML —Ç–∞–±–ª–∏—Ü.
–°–æ–¥–µ—Ä–∂–∏—Ç —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è —Ç–∞–±–ª–∏—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏–∑ HTML-–¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏—Ö –≤ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–∞—Ö (DataFrame, Excel).
"""

# –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
import pandas as pd  # –î–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ç–∞–±–ª–∏—á–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –∏ Excel
from bs4 import BeautifulSoup  # –î–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ HTML
import os  # –î–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–æ–π

def parse_html_tables(source: str):
    """
    –ü–∞—Ä—Å–∏—Ç –≤—Å–µ HTML —Ç–∞–±–ª–∏—Ü—ã –∏–∑ —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞.
    
    –≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç pandas.read_html() –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è
    –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü –∏–∑ HTML-–¥–æ–∫—É–º–µ–Ω—Ç–∞. –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –ø—Ä–æ—Å—Ç—ã—Ö —Å–ª—É—á–∞–µ–≤, –∫–æ–≥–¥–∞
    —Ç–∞–±–ª–∏—Ü—ã –∏–º–µ—é—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É.

    Parameters
    ----------
    source : str
        HTML —Ç–µ–∫—Å—Ç, –ø—É—Ç—å –∫ –ª–æ–∫–∞–ª—å–Ω–æ–º—É —Ñ–∞–π–ª—É –∏–ª–∏ URL-–∞–¥—Ä–µ—Å.

    Returns
    -------
    list[pd.DataFrame]
        –°–ø–∏—Å–æ–∫ DataFrame'–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–π –Ω–∞–π–¥–µ–Ω–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã.
        –ï—Å–ª–∏ —Ç–∞–±–ª–∏—Ü—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫.
    """
    try:
        # –ò—Å–ø–æ–ª—å–∑—É–µ–º pandas –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–∞—Ä—Å–∏–Ω–≥–∞ –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü
        tables = pd.read_html(source)
        return tables
    except ValueError:
        # –ï—Å–ª–∏ —Ç–∞–±–ª–∏—Ü—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã, pandas –≤—ã–±—Ä–æ—Å–∏—Ç ValueError
        print("‚ö†Ô∏è –¢–∞–±–ª–∏—Ü—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –≤ —É–∫–∞–∑–∞–Ω–Ω–æ–º –∏—Å—Ç–æ—á–Ω–∏–∫–µ")
        return []


def parse_html_table(html: str, index: int = 0):
    """
    –ü–∞—Ä—Å–∏—Ç –æ–¥–Ω—É HTML —Ç–∞–±–ª–∏—Ü—É —Å –ø–æ–º–æ—â—å—é BeautifulSoup.
    
    –≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –±–æ–ª–µ–µ –¥–µ—Ç–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ –ø—Ä–æ—Ü–µ—Å—Å–æ–º –ø–∞—Ä—Å–∏–Ω–≥–∞
    –∏ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏–∑–≤–ª–µ–∫–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ç–∞–±–ª–∏—Ü —Å–æ —Å–ª–æ–∂–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π.
    –ò—Å–ø–æ–ª—å–∑—É–µ—Ç BeautifulSoup –¥–ª—è —Ä—É—á–Ω–æ–≥–æ –æ–±—Ö–æ–¥–∞ DOM-–¥–µ—Ä–µ–≤–∞.

    Parameters
    ----------
    html : str
        HTML —Ä–∞–∑–º–µ—Ç–∫–∞, —Å–æ–¥–µ—Ä–∂–∞—â–∞—è –∫–∞–∫ –º–∏–Ω–∏–º—É–º –æ–¥–Ω—É —Ç–∞–±–ª–∏—Ü—É.
    index : int, optional
        –ò–Ω–¥–µ–∫—Å —Ç–∞–±–ª–∏—Ü—ã –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 0 - –ø–µ—Ä–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞).

    Returns
    -------
    list[list[str]]
        –†–∞—Å–ø–∞—Ä—Å–µ–Ω–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –≤ –≤–∏–¥–µ —Å–ø–∏—Å–∫–∞ —Å—Ç—Ä–æ–∫ —Å —è—á–µ–π–∫–∞–º–∏.
        –ö–∞–∂–¥–∞—è —Å—Ç—Ä–æ–∫–∞ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∞ —Å–ø–∏—Å–∫–æ–º —Å—Ç—Ä–æ–∫–æ–≤—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π —è—á–µ–µ–∫.
    """
    # –°–æ–∑–¥–∞–µ–º –æ–±—ä–µ–∫—Ç BeautifulSoup –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ HTML
    soup = BeautifulSoup(html, 'html.parser')
    
    # –ù–∞—Ö–æ–¥–∏–º –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã <table> –≤ HTML
    tables = soup.find_all('table')
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–∞–π–¥–µ–Ω—ã –ª–∏ —Ç–∞–±–ª–∏—Ü—ã –∏ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ —É–∫–∞–∑–∞–Ω–Ω—ã–π –∏–Ω–¥–µ–∫—Å
    if not tables or index >= len(tables):
        print(f"‚ö†Ô∏è –¢–∞–±–ª–∏—Ü–∞ —Å –∏–Ω–¥–µ–∫—Å–æ–º {index} –Ω–µ –Ω–∞–π–¥–µ–Ω–∞")
        return []
    
    # –í—ã–±–∏—Ä–∞–µ–º –Ω—É–∂–Ω—É—é —Ç–∞–±–ª–∏—Ü—É –ø–æ –∏–Ω–¥–µ–∫—Å—É
    table = tables[index]

    # –°–ø–∏—Å–æ–∫ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –≤—Å–µ—Ö —Å—Ç—Ä–æ–∫ —Ç–∞–±–ª–∏—Ü—ã
    rows: list[list[str]] = []
    
    # –ü—Ä–æ—Ö–æ–¥–∏–º –ø–æ –≤—Å–µ–º —Å—Ç—Ä–æ–∫–∞–º —Ç–∞–±–ª–∏—Ü—ã (<tr>)
    for tr in table.find_all('tr'):
        # –ò–∑–≤–ª–µ–∫–∞–µ–º —Ç–µ–∫—Å—Ç –∏–∑ –≤—Å–µ—Ö —è—á–µ–µ–∫ (–∫–∞–∫ <td>, —Ç–∞–∫ –∏ <th>)
        # strip=True —É–¥–∞–ª—è–µ—Ç –ª–∏—à–Ω–∏–µ –ø—Ä–æ–±–µ–ª—ã –≤ –Ω–∞—á–∞–ª–µ –∏ –∫–æ–Ω—Ü–µ
        cells = [td.get_text(strip=True) for td in tr.find_all(['td', 'th'])]
        
        # –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç—Ä–æ–∫—É —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –≤ –Ω–µ–π –µ—Å—Ç—å —è—á–µ–π–∫–∏
        if cells:
            rows.append(cells)
    
    return rows


def main():
    """
   
    
    –≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –≤—ã–ø–æ–ª–Ω—è–µ—Ç –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª –æ–±—Ä–∞–±–æ—Ç–∫–∏:
    1. –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É test.html
    2. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞
    3. –ß–∏—Ç–∞–µ—Ç HTML-–∫–æ–Ω—Ç–µ–Ω—Ç
    4. –ü–∞—Ä—Å–∏—Ç —Ç–∞–±–ª–∏—Ü—ã –¥–≤—É–º—è —Å–ø–æ—Å–æ–±–∞–º–∏ (BeautifulSoup –∏ pandas)
    5. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ Excel-—Ñ–∞–π–ª
    """
    # –ü–æ–ª—É—á–∞–µ–º –∞–±—Å–æ–ª—é—Ç–Ω—ã–π –ø—É—Ç—å –∫ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏, –≥–¥–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è —Å–∞–º —Å–∫—Ä–∏–ø—Ç
    # –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å —Ñ–∞–π–ª–∞–º–∏ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏—è —Å–∫—Ä–∏–ø—Ç–∞
    script_dir = os.path.dirname(os.path.abspath(__file__))
    
    # –§–æ—Ä–º–∏—Ä—É–µ–º –ø—É—Ç—å –∫ –≤—Ö–æ–¥–Ω–æ–º—É HTML-—Ñ–∞–π–ª—É –≤ –ø–∞–ø–∫–µ data (–Ω–∞ —É—Ä–æ–≤–µ–Ω—å –≤—ã—à–µ src)
    data_dir = os.path.abspath(os.path.join(script_dir, os.pardir, 'data'))
    html_file = os.path.join(data_dir, 'test.html')
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ –ø–µ—Ä–µ–¥ –æ–±—Ä–∞–±–æ—Ç–∫–æ–π
    if not os.path.exists(html_file):
        print(f"‚ùå –§–∞–π–ª {html_file} –Ω–µ –Ω–∞–π–¥–µ–Ω!")
        print("–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª data/test.html —Å HTML-–∫–æ–¥–æ–º, —Å–æ–¥–µ—Ä–∂–∞—â–∏–º —Ç–∞–±–ª–∏—Ü—ã.")
        return
    
    try:
        # –û—Ç–∫—Ä—ã–≤–∞–µ–º HTML-—Ñ–∞–π–ª –¥–ª—è —á—Ç–µ–Ω–∏—è —Å –∫–æ–¥–∏—Ä–æ–≤–∫–æ–π UTF-8
        # –≠—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä—É—Å—Å–∫–∏—Ö —Å–∏–º–≤–æ–ª–æ–≤
        with open(html_file, 'r', encoding='utf-8') as file:
            html_content = file.read()

        # –ü–∞—Ä—Å–∏–º —Ç–∞–±–ª–∏—Ü—É —Å –ø–æ–º–æ—â—å—é BeautifulSoup (–ø–µ—Ä–≤—ã–π —Å–ø–æ—Å–æ–±)
        print("üîç –ü–∞—Ä—Å–∏–Ω–≥ —Ç–∞–±–ª–∏—Ü—ã —Å –ø–æ–º–æ—â—å—é BeautifulSoup...")
        result = parse_html_table(html_content)
        
        if result:
            print(f"‚úÖ –ù–∞–π–¥–µ–Ω–æ {len(result)} —Å—Ç—Ä–æ–∫ –≤ —Ç–∞–±–ª–∏—Ü–µ")
            # –í—ã–≤–æ–¥–∏–º –ø–µ—Ä–≤—ã–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å—Ç—Ä–æ–∫ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
            for i, row in enumerate(result[:3]):
                print(f"   –°—Ç—Ä–æ–∫–∞ {i+1}: {row}")
        else:
            print("‚ùå –¢–∞–±–ª–∏—Ü—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –≤ HTML-—Ñ–∞–π–ª–µ.")

        # –ü–∞—Ä—Å–∏–Ω–≥ —Å –ø–æ–º–æ—â—å—é pandas (–≤—Ç–æ—Ä–æ–π —Å–ø–æ—Å–æ–±)
        print("\nüîç –ü–∞—Ä—Å–∏–Ω–≥ —Ç–∞–±–ª–∏—Ü —Å –ø–æ–º–æ—â—å—é pandas...")
        tables = pd.read_html(html_file)

        if tables:
            print(f"‚úÖ –ù–∞–π–¥–µ–Ω–æ {len(tables)} —Ç–∞–±–ª–∏—Ü")
            
            # –§–æ—Ä–º–∏—Ä—É–µ–º –ø—É—Ç—å –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è Excel-—Ñ–∞–π–ª–∞ –≤ –ø–∞–ø–∫–µ data
            output_excel_path = os.path.join(data_dir, "all_tables2.xlsx")
            
            # –°–æ–∑–¥–∞–µ–º Excel-—Ñ–∞–π–ª —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –ª–∏—Å—Ç–∞–º–∏ (–ø–æ –æ–¥–Ω–æ–º—É –Ω–∞ —Ç–∞–±–ª–∏—Ü—É)
            with pd.ExcelWriter(output_excel_path, engine="openpyxl") as writer:
                for i, table in enumerate(tables):
                    # –°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–∞–∂–¥—É—é —Ç–∞–±–ª–∏—Ü—É –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω—ã–π –ª–∏—Å—Ç
                    # sheet_name=f"Table_{i+1}" - –∏–º–µ–Ω—É–µ–º –ª–∏—Å—Ç—ã –∫–∞–∫ Table_1, Table_2, etc.
                    # index=False - –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –∏–Ω–¥–µ–∫—Å—ã —Å—Ç—Ä–æ–∫
                    table.to_excel(writer, sheet_name=f"Table_{i+1}", index=False)
                    print(f"   –¢–∞–±–ª–∏—Ü–∞ {i+1}: {table.shape[0]} —Å—Ç—Ä–æ–∫, {table.shape[1]} —Å—Ç–æ–ª–±—Ü–æ–≤")
            
            print(f"‚úÖ –§–∞–π–ª Excel —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω—ë–Ω: {output_excel_path}")
        else:
            print("‚ùå –¢–∞–±–ª–∏—Ü—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –≤ HTML-—Ñ–∞–π–ª–µ.")
            
    except Exception as e:
        # –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –ª—é–±—ã–µ –æ—à–∏–±–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –≤–æ–∑–Ω–∏–∫–Ω—É—Ç—å
        print(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Ñ–∞–π–ª–∞: {e}")
        print("–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Ñ–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π HTML-–∫–æ–¥ —Å —Ç–∞–±–ª–∏—Ü–∞–º–∏")


# –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –≤ –ø—Ä–æ–≥—Ä–∞–º–º—É
# –ö–æ–¥ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø—Ä—è–º–æ–º –∑–∞–ø—É—Å–∫–µ —Å–∫—Ä–∏–ø—Ç–∞
if __name__ == "__main__":
    main()

# %%

# %%

# %%

# %%


